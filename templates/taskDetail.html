{% extends "base.html" %}
{% load staticfiles %}
{% block content %}
    <div class="breadcrumbs">
        <div class="breadcrumbs-inner">
            <div class="row m-0">
                <div class="col-sm-4">
                    <div class="page-header float-left">
                        <div class="page-title">
                            <h1>Dashboard</h1>
                        </div>
                    </div>
                </div>
                <div class="col-sm-8">
                    <div class="page-header float-right">
                        <div class="page-title">
                            <ol class="breadcrumb text-right">
                                <li><a href="{% url 'index' %}">首页</a></li>
                                <li><a href="{% url 'showPlan' %}">计划栏</a></li>
                                <li><a href="/planDetail?pid={{ task_obj.plan.id }}">计划详情</a></li>
                                <li class="active">任务详情</li>
                            </ol>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Content -->
    <div class="content">
        <div class="animated fadeIn">
            <div class="row">
                <div class="col-md-12">
                    <div class="card">
                        <div class="card-header">
                            <strong class="card-title">执行任务</strong>
                        </div>
                        <div class="card-body">
                            <ul id="myTab" role="tablist">
                                {% for sequence in blueBlueSequences %}
                                    {% if sequence.priority == 1 %}
                                        <li id="step{{ sequence.priority }}Li" class="active blue">
                                            <a href="#" role="tab" data-toggle="tab">
                                                {{ sequence.priority }}.{{ sequence.segment.name }}
                                            </a>
                                        </li>
                                    {% else %}
                                        <li id="step{{ sequence.priority }}Li" class="active blue">
                                            <img id="step{{ sequence.priority }}Img"
                                                 src="{% static "images/blue_blue.png" %}"/>
                                            <a href="#" role="tab" data-toggle="tab">
                                                {{ sequence.priority }}.{{ sequence.segment.name }}
                                            </a>
                                        </li>
                                    {% endif %}
                                {% endfor %}
                                {% if blueGraySequence %}
                                    <li id="step{{ blueGraySequence.priority }}Li" class="gray">
                                        <img id="step{{ blueGraySequence.priority }}Img"
                                             src="{% static "images/blue_gray.png" %}"/>
                                        <a href="#" role="tab" data-toggle="tab">
                                            {{ blueGraySequence.priority }}.{{ blueGraySequence.segment.name }}
                                        </a>
                                    </li>
                                {% endif %}
                                {% if grayGraySequences %}
                                    {% for sequence in grayGraySequences %}
                                        <li id="step{{ sequence.priority }}Li" class="gray">
                                            <img id="step{{ sequence.priority }}Img"
                                                 src="{% static "images/gray_gray.png" %}"/>
                                            <a href="#" role="tab" data-toggle="tab">
                                                {{ sequence.priority }}.{{ sequence.segment.name }}
                                            </a>
                                        </li>
                                    {% endfor %}
                                {% endif %}
                            </ul>
                            <div id="myTabContent" class="tab-content">
                                {% for sequence in sequences %}
                                    {% if sequence.executeCursor == 1 %}
                                        {% if sequence.segment.isDeploy == 1 %}
                                            <div id="step{{ sequence.priority }}" class="tab-pane active">
                                                <h5 class="page-header"></h5>
                                                <div class="alert alert-primary" role="alert">
                                                    <h4 class="alert-heading">说明</h4>
                                                    <hr>
                                                    <p>1-发布可以单个项目部署，也可以一键全部部署</p>
                                                    <p>2-项目可以选择节点部署，可以回滚到上个版本</p>
                                                    <p>3-一键部署按之前选的执行顺序进行</p>
                                                </div>
                                                <p>【标题】{{ task_obj.name }}</p>
                                                <div id="buildMessage"></div>
                                                <table class="layui-table" id="build-table" lay-skin="line">
                                                    <thead>
                                                    <tr>
                                                        <th width="5px"><input type="checkbox"
                                                                               title="projectId"></th>
                                                        <th>编号</th>
                                                        <th width="200px">项目</th>
                                                        <th>构建号</th>
                                                        <th>部署状态</th>
                                                        <th width="200px">部署进度</th>
                                                        <th>当前信息</th>
                                                        <th width="200px">操作</th>
                                                        <th width="100px">历史记录</th>
                                                    </tr>
                                                    </thead>
                                                    <tbody>
                                                    {% for project_plan in project_plans %}
                                                        <tr id="proBuild{{ project_plan.id }}">
                                                            <td width="5px" id="{{ project_plan.id }}"><input
                                                                    type="checkbox"
                                                                    title="projectId"></td>
                                                            <td id="project_plan_id">{{ project_plan.id }}</td>
                                                            <td>{{ project_plan.project.name }}</td>
                                                            <td>{{ project_plan.lastPackageId }}</td>
                                                            {% if project_plan.proBuildStatus %}
                                                                <td id="proBuildStatus">已部署</td>
                                                            {% else %}
                                                                <td id="proBuildStatus">未部署</td>
                                                            {% endif %}
                                                            <td id="progress">未进行</td>
                                                            <td id="jenkinsConsole">无</td>
                                                            <td>
                                                                <div class="layui-btn-group">
                                                                    <button class="layui-btn layui-btn-xs layui-btn-radius layui-btn-normal"
                                                                            id="startOneDeploy">
                                                                        发布
                                                                    </button>
                                                                    <button class="layui-btn layui-btn-xs layui-btn-radius layui-btn-normal"
                                                                            data-toggle="modal"
                                                                            data-target="#largeModal"
                                                                            onclick="selectIP({{ project_plan.id }})">
                                                                        选节点部署
                                                                    </button>
                                                                    <button class="layui-btn layui-btn-xs layui-btn-radius layui-btn-normal"
                                                                            id="rollback">
                                                                        回滚
                                                                    </button>
                                                                </div>
                                                            </td>
                                                            <td>
                                                                <a href="/pro_console_opt/{{ project_plan.id }}"
                                                                   class='btn btn-link btn-sm'>点击查看</a>
                                                            </td>
                                                        </tr>
                                                    {% endfor %}
                                                    </tbody>
                                                </table>
                                                <div class="modal fade" id="largeModal" tabindex="-1" role="dialog"
                                                     aria-labelledby="largeModalLabel" aria-hidden="true">
                                                    <div class="modal-dialog modal-lg" role="document">
                                                        <div class="modal-content">
                                                            <div class="modal-header">
                                                                <h5 class="modal-title" id="largeModalLabel">
                                                                    选择节点</h5>
                                                                <button type="button" class="close"
                                                                        data-dismiss="modal"
                                                                        aria-label="Close">
                                                                    <span aria-hidden="true">&times;</span>
                                                                </button>
                                                            </div>
                                                            <div class="modal-body">
                                                                <table class="table table-striped table-bordered"
                                                                       id="select-nodes">
                                                                    <thead>
                                                                    <tr>
                                                                        <th width="5px"><input type="checkbox"
                                                                                               title="node">
                                                                        </th>
                                                                        <th width="100px">项目编号</th>
                                                                        <th>节点名</th>
                                                                        <th>IP</th>
                                                                    </tr>
                                                                    </thead>
                                                                    <tbody></tbody>
                                                                </table>
                                                            </div>
                                                            <div class="modal-footer">
                                                                <button type="button" class="btn btn-secondary"
                                                                        data-dismiss="modal"
                                                                        onclick="location.reload()">
                                                                    取消
                                                                </button>
                                                                <button type="button"
                                                                        class="layui-btn layui-btn-normal"
                                                                        id="selectNodesDeploy"
                                                                        data-dismiss="modal">发布
                                                                </button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="layui-btn-group">
                                                    <button class="layui-btn layui-btn-xs layui-btn-radius layui-btn-normal">
                                                        一键部署
                                                    </button>
                                                </div>
                                                {% if sequence.implemented == 0 %}
                                                    <div class="layui-btn-group" style="float: right">
                                                        {% if sequence.priority > 1 %}
                                                            <a href="#step{{ sequence.pre_segment }}" role="tab"
                                                               onclick="eventFun.setStep({{ sequence.pre_segment }})"
                                                               data-toggle="tab">
                                                                <button type="button"
                                                                        class="layui-btn layui-btn-primary">上一步
                                                                </button>
                                                            </a>
                                                        {% endif %}
                                                        <a href="#step{{ sequence.next_segment }}"
                                                           onclick="eventFun.setStep({{ sequence.next_segment }})"
                                                           role="tab" data-toggle="tab">
                                                            <button type="button" id="nextBtn"
                                                                    class="layui-btn layui-btn-primary"
                                                                    style="display: none">下一步
                                                            </button>
                                                        </a>
                                                    </div>
                                                {% else %}
                                                    <div class="layui-btn-group" style="float: right">
                                                        {% if sequence.priority > 1 %}
                                                            <a href="#step{{ sequence.pre_segment }}"
                                                               onclick="eventFun.setStep({{ sequence.pre_segment }})"
                                                               role="tab" data-toggle="tab">
                                                                <button type="button"
                                                                        class="layui-btn layui-btn-primary">上一步
                                                                </button>
                                                            </a>
                                                        {% endif %}
                                                        <a href="#step{{ sequence.next_segment }}"
                                                           onclick="eventFun.setStep({{ sequence.next_segment }})"
                                                           role="tab" data-toggle="tab">
                                                            <button type="button" class="layui-btn layui-btn-primary">
                                                                下一步
                                                            </button>
                                                        </a>
                                                    </div>
                                                {% endif %}
                                            </div>
                                        {% elif sequence.segment.isCheck == 1 %}
                                            <div id="step{{ sequence.priority }}" class="tab-pane active">
                                                <h5 class="page-header"></h5>
                                                <div class="alert alert-primary" role="alert">
                                                    <h4 class="alert-heading">说明</h4>
                                                    <hr>
                                                    <p>1-在输入框中输入验收细节情况</p>
                                                    <p>2-点击“通过”按钮完成验收</p>
                                                </div>
                                                {% if sequence.implemented == 0 %}
                                                    <p id="p1" class="fade"></p>
                                                    <textarea class="form-control" name="remark"
                                                              id="remark"
                                                              placeholder="请输入验收结果" rows="4"></textarea>
                                                    <h5 class="page-header"></h5>
                                                    <button type="button" id="{{ sequence.id }}"
                                                            class="layui-btn layui-btn-primary checkSuccess">
                                                        通过
                                                    </button>
                                                    <h5 class="page-header"></h5>
                                                    <div class="layui-btn-group" style="float: right">
                                                        <a href="#step{{ sequence.pre_segment }}"
                                                           onclick="eventFun.setStep({{ sequence.pre_segment }})"
                                                           role="tab" data-toggle="tab">
                                                            <button type="button" class="layui-btn layui-btn-primary">
                                                                上一步
                                                            </button>
                                                        </a>
                                                        <a href="#step{{ sequence.next_segment }}"
                                                           onclick="eventFun.setStep({{ sequence.next_segment }})"
                                                           role="tab" data-toggle="tab">
                                                            <button type="button" id="nextBtn"
                                                                    class="layui-btn layui-btn-primary"
                                                                    style="display: none">下一步
                                                            </button>
                                                        </a>
                                                    </div>
                                                {% else %}
                                                    <p id="p1">
                                                        <br>验收人：{{ sequence.executor.name }}
                                                        <br>验收日期：{{ sequence.executeDate }}
                                                        <br>备注：{{ sequence.remarks }}
                                                    </p>
                                                    <div class="layui-btn-group" style="float: right">
                                                        <a href="#step{{ sequence.pre_segment }}"
                                                           onclick="eventFun.setStep({{ sequence.pre_segment }})"
                                                           role="tab" data-toggle="tab">
                                                            <button type="button" class="layui-btn layui-btn-primary">
                                                                上一步
                                                            </button>
                                                        </a>
                                                        <a href="#step{{ sequence.next_segment }}"
                                                           onclick="eventFun.setStep({{ sequence.next_segment }})"
                                                           role="tab" data-toggle="tab">
                                                            <button type="button" class="layui-btn layui-btn-primary">
                                                                下一步
                                                            </button>
                                                        </a>
                                                    </div>
                                                {% endif %}
                                            </div>
                                        {% elif sequence.segment.isMerge == 1 %}
                                            <div id="step{{ sequence.priority }}" class="tab-pane active">
                                                <h5 class="page-header"></h5>
                                                <div class="alert alert-primary" role="alert">
                                                    <h4 class="alert-heading">说明</h4>
                                                    <hr>
                                                    <p>1-代码在项目验收后，由任务创建者（开发）进行代码合并</p>
                                                    <p>2-点击“合并代码”按钮，将代码合并入master</p>
                                                    <p>3-进度条显示的是所有项目的总进度</p>
                                                </div>
                                                {% if sequence.implemented == 0 %}
                                                    <div class="text" style="text-align:center;">
                                                        <p id="codeMergeText"></p>
                                                    </div>
                                                    <div class="progress mb-2 codeMergeProgress" style="display: none">
                                                        <div class="progress-bar bg-success progress-bar-striped progress-bar-animated"
                                                             id="codeMergeProgressLine" role="progressbar"
                                                             style="width: 5%"
                                                             aria-valuenow="55" aria-valuemin="0"
                                                             aria-valuemax="100">
                                                        </div>
                                                    </div>
                                                    <button class="layui-btn layui-btn-primary startCodeMerge"
                                                            data-type="loading">合并代码
                                                    </button>
                                                    <h5 class="page-header"></h5>
                                                    <div class="layui-col-md12">
                                                        <div class="layui-card">
                                                            <div class="layui-card-header" style="display: none"
                                                                 id="codeMergeOpt">
                                                                <strong>合并进度</strong></div>
                                                            <div class="layui-card-body codeMergeResult"></div>
                                                        </div>
                                                    </div>
                                                    <h5 class="page-header"></h5>
                                                    <div class="layui-btn-group" style="float: right">
                                                        <a href="#step{{ sequence.pre_segment }}"
                                                           onclick="eventFun.setStep({{ sequence.pre_segment }})"
                                                           role="tab" data-toggle="tab">
                                                            <button type="button" class="layui-btn layui-btn-primary">
                                                                上一步
                                                            </button>
                                                        </a>
                                                    </div>
                                                {% else %}
                                                    <table class="table">
                                                        <thead>
                                                        <tr>
                                                            <th scope="col">项目</th>
                                                            <th scope="col">结果</th>
                                                            <th scope="col">人员</th>
                                                            <th scope="col">日期</th>
                                                        </tr>
                                                        </thead>
                                                        <tbody>
                                                        {% for project_plan in project_plans %}
                                                            <tr>
                                                                <td>{{ project_plan.project.name }}</td>
                                                                {% if project_plan.mergeStatus == 0 %}
                                                                    <td>未合并</td>
                                                                {% elif project_plan.mergeStatus == 1 %}
                                                                    <td>合并完成</td>
                                                                {% elif project_plan.mergeStatus == 2 %}
                                                                    <td>合并冲突</td>
                                                                {% endif %}
                                                                <td>{{ sequence.executor }}</td>
                                                                <td>{{ sequence.executeDate }}</td>
                                                            </tr>
                                                        {% endfor %}
                                                        </tbody>
                                                    </table>
                                                    <div class="layui-btn-group" style="float: right">
                                                        <a href="#step{{ sequence.pre_segment }}"
                                                           onclick="eventFun.setStep({{ sequence.pre_segment }})"
                                                           role="tab" data-toggle="tab">
                                                            <button type="button" class="layui-btn layui-btn-primary">
                                                                上一步
                                                            </button>
                                                        </a>
                                                    </div>
                                                {% endif %}
                                            </div>
                                        {% else %}
                                            <div id="step{{ sequence.priority }}" class="tab-pane active">
                                                <h5 class="page-header"></h5>
                                                <div class="alert alert-primary" role="alert">
                                                    <h4 class="alert-heading">说明</h4>
                                                    <hr>
                                                    <p>1-在文本框中填写操作的相关备注</p>
                                                    <p>2-完成后点击“执行”，进入下一环节</p>
                                                </div>
                                                {% if sequence.implemented == 0 %}
                                                    <p id="p1" class="fade"></p>
                                                    <textarea class="form-control" name="desc" id="remark"
                                                              placeholder="请输入发布的一些备注（包括：需要执行的SQL、修改更新内容等等）"
                                                              rows="4" value=""></textarea>
                                                    <h5 class="page-header"></h5>
                                                    <button type="button"
                                                            class="layui-btn layui-btn-primary segmentBtn"
                                                            id="{{ sequence.id }}">执行
                                                    </button>
                                                    <div class="layui-btn-group" style="float: right">
                                                        {% if sequence.priority > 1 %}
                                                            <a href="#step{{ sequence.pre_segment }}"
                                                               onclick="eventFun.setStep({{ sequence.pre_segment }})"
                                                               role="tab" data-toggle="tab">
                                                                <button type="button"
                                                                        class="layui-btn layui-btn-primary">上一步
                                                                </button>
                                                            </a>
                                                        {% endif %}
                                                        <a href="#step{{ sequence.next_segment }}"
                                                           onclick="eventFun.setStep({{ sequence.next_segment }})"
                                                           role="tab" data-toggle="tab">
                                                            <button type="button" id="nextBtn"
                                                                    class="layui-btn layui-btn-primary"
                                                                    style="display: none">下一步
                                                            </button>
                                                        </a>
                                                    </div>
                                                {% else %}
                                                    <h5 class="page-header"></h5>
                                                    <p>
                                                        执行人：{{ sequence.executor.name }}</p>
                                                    <p>备注：{{ sequence.remarks }}</p>
                                                    <div class="layui-btn-group" style="float: right">
                                                        {% if sequence.priority > 1 %}
                                                            <a href="#step{{ sequence.pre_segment }}"
                                                               onclick="eventFun.setStep({{ sequence.pre_segment }})"
                                                               role="tab" data-toggle="tab">
                                                                <button type="button"
                                                                        class="layui-btn layui-btn-primary">上一步
                                                                </button>
                                                            </a>
                                                        {% endif %}
                                                        <a href="#step{{ sequence.next_segment }}"
                                                           onclick="eventFun.setStep({{ sequence.next_segment }})"
                                                           role="tab" data-toggle="tab">
                                                            <button type="button" class="layui-btn layui-btn-primary">
                                                                下一步
                                                            </button>
                                                        </a>
                                                    </div>
                                                {% endif %}
                                            </div>
                                        {% endif %}
                                    {% else %}
                                        {% if sequence.segment.isDeploy == 1 %}
                                            <div id="step{{ sequence.priority }}" class="tab-pane fade">
                                                <h5 class="page-header"></h5>
                                                <div class="alert alert-primary" role="alert">
                                                    <h4 class="alert-heading">说明</h4>
                                                    <hr>
                                                    <p>1-发布可以单个项目部署，也可以一键全部部署</p>
                                                    <p>2-项目可以选择节点部署，可以回滚到上个版本</p>
                                                    <p>3-一键部署按之前选的执行顺序进行</p>
                                                </div>
                                                <p>【标题】{{ task_obj.name }}</p>
                                                <div id="buildMessage"></div>
                                                <table class="layui-table" id="build-table" lay-skin="line">
                                                    <thead>
                                                    <tr>
                                                        <th width="5px"><input type="checkbox"
                                                                               title="projectId"></th>
                                                        <th>编号</th>
                                                        <th width="200px">项目</th>
                                                        <th>构建号</th>
                                                        <th>部署状态</th>
                                                        <th width="200px">部署进度</th>
                                                        <th>当前信息</th>
                                                        <th width="200px">操作</th>
                                                        <th width="100px">历史记录</th>
                                                    </tr>
                                                    </thead>
                                                    <tbody>
                                                    {% for project_plan in project_plans %}
                                                        <tr id="proBuild{{ project_plan.id }}">
                                                            <td width="5px" id="{{ project_plan.id }}"><input
                                                                    type="checkbox"
                                                                    title="projectId"></td>
                                                            <td id="project_plan_id">{{ project_plan.id }}</td>
                                                            <td>{{ project_plan.project.name }}</td>
                                                            <td>{{ project_plan.lastPackageId }}</td>
                                                            {% if project_plan.proBuildStatus %}
                                                                <td id="proBuildStatus">已部署</td>
                                                            {% else %}
                                                                <td id="proBuildStatus">未部署</td>
                                                            {% endif %}
                                                            <td id="progress">未进行</td>
                                                            <td id="jenkinsConsole">无</td>
                                                            <td>
                                                                <div class="layui-btn-group">
                                                                    <button class="layui-btn layui-btn-xs layui-btn-radius layui-btn-normal"
                                                                            id="startOneDeploy">
                                                                        发布
                                                                    </button>
                                                                    <button class="layui-btn layui-btn-xs layui-btn-radius layui-btn-normal"
                                                                            data-toggle="modal"
                                                                            data-target="#largeModal"
                                                                            onclick="selectIP({{ project_plan.id }})">
                                                                        选节点部署
                                                                    </button>
                                                                    <button class="layui-btn layui-btn-xs layui-btn-radius layui-btn-normal"
                                                                            id="rollback">
                                                                        回滚
                                                                    </button>
                                                                </div>
                                                            </td>
                                                            <td>
                                                                <a href="/pro_console_opt/{{ project_plan.id }}"
                                                                   class='btn btn-link btn-sm'>点击查看</a>
                                                            </td>
                                                        </tr>
                                                    {% endfor %}
                                                    </tbody>
                                                </table>
                                                <div class="modal fade" id="largeModal" tabindex="-1" role="dialog"
                                                     aria-labelledby="largeModalLabel" aria-hidden="true">
                                                    <div class="modal-dialog modal-lg" role="document">
                                                        <div class="modal-content">
                                                            <div class="modal-header">
                                                                <h5 class="modal-title" id="largeModalLabel">
                                                                    选择节点</h5>
                                                                <button type="button" class="close"
                                                                        data-dismiss="modal"
                                                                        aria-label="Close">
                                                                    <span aria-hidden="true">&times;</span>
                                                                </button>
                                                            </div>
                                                            <div class="modal-body">
                                                                <table class="table table-striped table-bordered"
                                                                       id="select-nodes">
                                                                    <thead>
                                                                    <tr>
                                                                        <th width="5px"><input type="checkbox"
                                                                                               title="node">
                                                                        </th>
                                                                        <th width="100px">项目编号</th>
                                                                        <th>节点名</th>
                                                                        <th>IP</th>
                                                                    </tr>
                                                                    </thead>
                                                                    <tbody></tbody>
                                                                </table>
                                                            </div>
                                                            <div class="modal-footer">
                                                                <button type="button" class="btn btn-secondary"
                                                                        data-dismiss="modal"
                                                                        onclick="location.reload()">
                                                                    取消
                                                                </button>
                                                                <button type="button"
                                                                        class="layui-btn layui-btn-normal"
                                                                        id="selectNodesDeploy"
                                                                        data-dismiss="modal">发布
                                                                </button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="layui-btn-group">
                                                    <button class="layui-btn layui-btn-xs layui-btn-radius layui-btn-normal">
                                                        一键部署
                                                    </button>
                                                </div>
                                                {% if sequence.implemented == 0 %}
                                                    <div class="layui-btn-group" style="float: right">
                                                        {% if sequence.priority > 1 %}
                                                            <a href="#step{{ sequence.pre_segment }}" role="tab"
                                                               onclick="eventFun.setStep({{ sequence.pre_segment }})"
                                                               data-toggle="tab">
                                                                <button type="button"
                                                                        class="layui-btn layui-btn-primary">上一步
                                                                </button>
                                                            </a>
                                                        {% endif %}
                                                        <a href="#step{{ sequence.next_segment }}"
                                                           onclick="eventFun.setStep({{ sequence.next_segment }})"
                                                           role="tab" data-toggle="tab">
                                                            <button type="button" id="nextBtn"
                                                                    class="layui-btn layui-btn-primary"
                                                                    style="display: none">下一步
                                                            </button>
                                                        </a>
                                                    </div>
                                                {% else %}
                                                    <div class="layui-btn-group" style="float: right">
                                                        {% if sequence.priority > 1 %}
                                                            <a href="#step{{ sequence.pre_segment }}"
                                                               onclick="eventFun.setStep({{ sequence.pre_segment }})"
                                                               role="tab" data-toggle="tab">
                                                                <button type="button"
                                                                        class="layui-btn layui-btn-primary">上一步
                                                                </button>
                                                            </a>
                                                        {% endif %}
                                                        <a href="#step{{ sequence.next_segment }}"
                                                           onclick="eventFun.setStep({{ sequence.next_segment }})"
                                                           role="tab" data-toggle="tab">
                                                            <button type="button" class="layui-btn layui-btn-primary">
                                                                下一步
                                                            </button>
                                                        </a>
                                                    </div>
                                                {% endif %}
                                            </div>
                                        {% elif sequence.segment.isCheck == 1 %}
                                            <div id="step{{ sequence.priority }}" class="tab-pane fade">
                                                <h5 class="page-header"></h5>
                                                <div class="alert alert-primary" role="alert">
                                                    <h4 class="alert-heading">说明</h4>
                                                    <hr>
                                                    <p>1-在输入框中输入验收细节情况</p>
                                                    <p>2-点击“通过”按钮完成验收</p>
                                                </div>
                                                {% if sequence.implemented == 0 %}
                                                    <p id="p1" class="fade"></p>
                                                    <textarea class="form-control" name="remark"
                                                              id="remark"
                                                              placeholder="请输入验收结果" rows="4"></textarea>
                                                    <h5 class="page-header"></h5>
                                                    <button type="button" id="{{ sequence.id }}"
                                                            class="layui-btn layui-btn-primary checkSuccess">
                                                        通过
                                                    </button>
                                                    <h5 class="page-header"></h5>
                                                    <div class="layui-btn-group" style="float: right">
                                                        <a href="#step{{ sequence.pre_segment }}"
                                                           onclick="eventFun.setStep({{ sequence.pre_segment }})"
                                                           role="tab" data-toggle="tab">
                                                            <button type="button" class="layui-btn layui-btn-primary">
                                                                上一步
                                                            </button>
                                                        </a>
                                                        <a href="#step{{ sequence.next_segment }}"
                                                           onclick="eventFun.setStep({{ sequence.next_segment }})"
                                                           role="tab" data-toggle="tab">
                                                            <button type="button" id="nextBtn"
                                                                    class="layui-btn layui-btn-primary"
                                                                    style="display: none">下一步
                                                            </button>
                                                        </a>
                                                    </div>
                                                {% else %}
                                                    <p id="p1">
                                                        <br>验收人：{{ sequence.executor.name }}
                                                        <br>验收日期：{{ sequence.executeDate }}
                                                        <br>备注：{{ sequence.remarks }}
                                                    </p>
                                                    <div class="layui-btn-group" style="float: right">
                                                        <a href="#step{{ sequence.pre_segment }}"
                                                           onclick="eventFun.setStep({{ sequence.pre_segment }})"
                                                           role="tab" data-toggle="tab">
                                                            <button type="button" class="layui-btn layui-btn-primary">
                                                                上一步
                                                            </button>
                                                        </a>
                                                        <a href="#step{{ sequence.next_segment }}"
                                                           onclick="eventFun.setStep({{ sequence.next_segment }})"
                                                           role="tab" data-toggle="tab">
                                                            <button type="button" class="layui-btn layui-btn-primary">
                                                                下一步
                                                            </button>
                                                        </a>
                                                    </div>
                                                {% endif %}
                                            </div>
                                        {% elif sequence.segment.isMerge == 1 %}
                                            <div id="step{{ sequence.priority }}" class="tab-pane fade">
                                                <h5 class="page-header"></h5>
                                                <div class="alert alert-primary" role="alert">
                                                    <h4 class="alert-heading">说明</h4>
                                                    <hr>
                                                    <p>1-代码在项目验收后，由任务创建者（开发）进行代码合并</p>
                                                    <p>2-点击“合并代码”按钮，将代码合并入master</p>
                                                    <p>3-进度条显示的是所有项目的总进度</p>
                                                </div>
                                                {% if sequence.implemented == 0 %}
                                                    <div class="text" style="text-align:center;">
                                                        <p id="codeMergeText"></p>
                                                    </div>
                                                    <div class="progress mb-2 codeMergeProgress" style="display: none">
                                                        <div class="progress-bar bg-success progress-bar-striped progress-bar-animated"
                                                             id="codeMergeProgressLine" role="progressbar"
                                                             style="width: 5%"
                                                             aria-valuenow="55" aria-valuemin="0"
                                                             aria-valuemax="100">
                                                        </div>
                                                    </div>
                                                    <button class="layui-btn layui-btn-primary startCodeMerge"
                                                            data-type="loading">合并代码
                                                    </button>
                                                    <h5 class="page-header"></h5>
                                                    <div class="layui-col-md12">
                                                        <div class="layui-card">
                                                            <div class="layui-card-header" style="display: none"
                                                                 id="codeMergeOpt">
                                                                <strong>合并进度</strong></div>
                                                            <div class="layui-card-body codeMergeResult"></div>
                                                        </div>
                                                    </div>
                                                    <h5 class="page-header"></h5>
                                                    <div class="layui-btn-group" style="float: right">
                                                        <a href="#step{{ sequence.pre_segment }}"
                                                           onclick="eventFun.setStep({{ sequence.pre_segment }})"
                                                           role="tab" data-toggle="tab">
                                                            <button type="button" class="layui-btn layui-btn-primary">
                                                                上一步
                                                            </button>
                                                        </a>
                                                    </div>
                                                {% else %}
                                                    <table class="table">
                                                        <thead>
                                                        <tr>
                                                            <th scope="col">项目</th>
                                                            <th scope="col">结果</th>
                                                            <th scope="col">人员</th>
                                                            <th scope="col">日期</th>
                                                        </tr>
                                                        </thead>
                                                        <tbody>
                                                        {% for project_plan in project_plans %}
                                                            <tr>
                                                                <td>{{ project_plan.project.name }}</td>
                                                                {% if project_plan.mergeStatus == 0 %}
                                                                    <td>未合并</td>
                                                                {% elif project_plan.mergeStatus == 1 %}
                                                                    <td>合并完成</td>
                                                                {% elif project_plan.mergeStatus == 2 %}
                                                                    <td>合并冲突</td>
                                                                {% endif %}
                                                                <td>{{ sequence.executor }}</td>
                                                                <td>{{ sequence.executeDate }}</td>
                                                            </tr>
                                                        {% endfor %}
                                                        </tbody>
                                                    </table>
                                                    <div class="layui-btn-group" style="float: right">
                                                        <a href="#step{{ sequence.pre_segment }}"
                                                           onclick="eventFun.setStep({{ sequence.pre_segment }})"
                                                           role="tab" data-toggle="tab">
                                                            <button type="button" class="layui-btn layui-btn-primary">
                                                                上一步
                                                            </button>
                                                        </a>
                                                    </div>
                                                {% endif %}
                                            </div>
                                        {% else %}
                                            <div id="step{{ sequence.priority }}" class="tab-pane fade">
                                                <h5 class="page-header"></h5>
                                                <div class="alert alert-primary" role="alert">
                                                    <h4 class="alert-heading">说明</h4>
                                                    <hr>
                                                    <p>1-在文本框中填写操作的相关备注</p>
                                                    <p>2-完成后点击“执行”，进入下一环节</p>
                                                </div>
                                                {% if sequence.implemented == 0 %}
                                                    <p id="p1" class="fade"></p>
                                                    <textarea class="form-control" name="desc" id="remark"
                                                              placeholder="请输入发布的一些备注（包括：需要执行的SQL、修改更新内容等等）"
                                                              rows="4" value=""></textarea>
                                                    <h5 class="page-header"></h5>
                                                    <button type="button"
                                                            class="layui-btn layui-btn-primary segmentBtn"
                                                            id="{{ sequence.id }}">执行
                                                    </button>
                                                    <div class="layui-btn-group" style="float: right">
                                                        {% if sequence.priority > 1 %}
                                                            <a href="#step{{ sequence.pre_segment }}"
                                                               onclick="eventFun.setStep({{ sequence.pre_segment }})"
                                                               role="tab" data-toggle="tab">
                                                                <button type="button"
                                                                        class="layui-btn layui-btn-primary">上一步
                                                                </button>
                                                            </a>
                                                        {% endif %}
                                                        <a href="#step{{ sequence.next_segment }}"
                                                           onclick="eventFun.setStep({{ sequence.next_segment }})"
                                                           role="tab" data-toggle="tab">
                                                            <button type="button" id="nextBtn"
                                                                    class="layui-btn layui-btn-primary"
                                                                    style="display: none">下一步
                                                            </button>
                                                        </a>
                                                    </div>
                                                {% else %}
                                                    <h5 class="page-header"></h5>
                                                    <p>
                                                        执行人：{{ sequence.executor.name }}</p>
                                                    <p>备注：{{ sequence.remarks }}</p>
                                                    <div class="layui-btn-group" style="float: right">
                                                        {% if sequence.priority > 1 %}
                                                            <a href="#step{{ sequence.pre_segment }}"
                                                               onclick="eventFun.setStep({{ sequence.pre_segment }})"
                                                               role="tab" data-toggle="tab">
                                                                <button type="button"
                                                                        class="layui-btn layui-btn-primary">上一步
                                                                </button>
                                                            </a>
                                                        {% endif %}
                                                        <a href="#step{{ sequence.next_segment }}"
                                                           onclick="eventFun.setStep({{ sequence.next_segment }})"
                                                           role="tab" data-toggle="tab">
                                                            <button type="button" class="layui-btn layui-btn-primary">
                                                                下一步
                                                            </button>
                                                        </a>
                                                    </div>
                                                {% endif %}
                                            </div>
                                        {% endif %}
                                    {% endif %}
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                </div>
            </div><!-- .animated -->
        </div><!-- .content -->
    </div>
{% endblock %}